<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kubernetes | Liceo</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Ayudando a las personas en riesgo de exclusion social">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.f1075b4d.css" as="style"><link rel="preload" href="/assets/js/app.728012cb.js" as="script"><link rel="preload" href="/assets/js/2.4ce31a1d.js" as="script"><link rel="preload" href="/assets/js/22.29424e28.js" as="script"><link rel="prefetch" href="/assets/js/10.f3191444.js"><link rel="prefetch" href="/assets/js/11.c0fc0644.js"><link rel="prefetch" href="/assets/js/12.8c21e88d.js"><link rel="prefetch" href="/assets/js/13.ca879377.js"><link rel="prefetch" href="/assets/js/14.cbd2def2.js"><link rel="prefetch" href="/assets/js/15.60c7453f.js"><link rel="prefetch" href="/assets/js/16.cfacd2c3.js"><link rel="prefetch" href="/assets/js/17.d8352974.js"><link rel="prefetch" href="/assets/js/18.83b39ee3.js"><link rel="prefetch" href="/assets/js/19.598ef237.js"><link rel="prefetch" href="/assets/js/20.5c0a69a5.js"><link rel="prefetch" href="/assets/js/21.c6b84bc5.js"><link rel="prefetch" href="/assets/js/23.cc4c65cb.js"><link rel="prefetch" href="/assets/js/3.5fe7f172.js"><link rel="prefetch" href="/assets/js/4.bf905f50.js"><link rel="prefetch" href="/assets/js/5.44066470.js"><link rel="prefetch" href="/assets/js/6.ffe6f60a.js"><link rel="prefetch" href="/assets/js/7.a00e933e.js"><link rel="prefetch" href="/assets/js/8.fb524a5c.js"><link rel="prefetch" href="/assets/js/9.2250d602.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f1075b4d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Liceo</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link">
  Guia
</a></div><div class="nav-item"><a href="/install/" class="nav-link router-link-active">
  Instalacion
</a></div><div class="nav-item"><a href="/development/" class="nav-link">
  Desarrollo
</a></div> <a href="https://github.com/liceo-social/liceo-social.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link">
  Guia
</a></div><div class="nav-item"><a href="/install/" class="nav-link router-link-active">
  Instalacion
</a></div><div class="nav-item"><a href="/development/" class="nav-link">
  Desarrollo
</a></div> <a href="https://github.com/liceo-social/liceo-social.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Instalacion</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/install/" aria-current="page" class="sidebar-link">Instalacion</a></li><li><a href="/install/docker.html" class="sidebar-link">Docker</a></li><li><a href="/install/docker-compose.html" class="sidebar-link">Docker Compose</a></li><li><a href="/install/k8s-helm.html" aria-current="page" class="active sidebar-link">Kubernetes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/install/k8s-helm.html#helm" class="sidebar-link">Helm</a></li></ul></li><li><a href="/install/manual.html" class="sidebar-link">Manual</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="kubernetes"><a href="#kubernetes" class="header-anchor">#</a> Kubernetes</h1> <h2 id="helm"><a href="#helm" class="header-anchor">#</a> Helm</h2> <h3 id="prerequisitos"><a href="#prerequisitos" class="header-anchor">#</a> Prerequisitos</h3> <p>Para poder desplegar Liceo en un entorno Kubernetes, hemos creado un chart de Helm. Este chart despliega una instancia de Liceo y una instancia de PostgreSQL como base de datos. Esta instalacion presupone que se quiere ejecutar Helm desde una maquina locale instalar el chart de Helm en un entorno de Kubernetes remoto.</p> <p>Para poder utilizar este chart previamente se debe:</p> <ul><li>Instalar kubectl (<a href="https://kubernetes.io/es/docs/tasks/tools/install-kubectl/" target="_blank" rel="noopener noreferrer">documentacion externa<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</li> <li>Instalar Helm (<a href="https://helm.sh/docs/intro/install/" target="_blank" rel="noopener noreferrer">documentacion externa<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</li> <li>Clonar el chart de Helm</li> <li>Ejecutar el chart de Helm</li></ul> <p>Para instalar kubectl y Helm recomendamos visitar la documentacion de ambos proyectos. Una vez instalados kubectl y Helm deberemos clonar el repositorio liceo-helm en nuestra maquina local usando <a href="https://git-scm.com/" target="_blank" rel="noopener noreferrer">Git<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">git</span> clone https://github.com/liceo-social/liceo-helm.github.io
</code></pre></div><h3 id="configurando-el-chart"><a href="#configurando-el-chart" class="header-anchor">#</a> Configurando el chart</h3> <p>Una vez clonado, deberemos crear un fichero <code>values.yaml</code> con los valores que queramos para la instancia de Liceo en el entorno en el que lo vamos a instalar: password del administrador, de la base de datos, donde se guardaran los ficheros...etc. Hay un fichero <code>values.yaml.template</code> que se puede usar de guia. Por un lado estan la configuracion de la base de datos:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">db</span><span class="token punctuation">:</span>
  <span class="token key atrule">deployment</span><span class="token punctuation">:</span>    
    <span class="token comment"># donde se guardara la base de datos en disco</span>
    <span class="token key atrule">disk_mount</span><span class="token punctuation">:</span> /var/data
    <span class="token key atrule">pg_data</span><span class="token punctuation">:</span> /var/data/liceo    
    <span class="token comment"># nombre de la base de datos</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> liceo
    <span class="token comment"># nombre del usuario de la base de datos</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> liceo
    <span class="token comment"># password del usuario de la base de datos</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> liceo
    <span class="token comment"># puerto en el que se expone el contenedor</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5432</span>
  <span class="token key atrule">service</span><span class="token punctuation">:</span>
    <span class="token comment"># puerto en el que se expondra el servicio al resto de servicios k8s</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5432</span>
</code></pre></div><p>Y por otro el de la instancia de Liceo:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">web</span><span class="token punctuation">:</span>
  <span class="token key atrule">deployment</span><span class="token punctuation">:</span>
    <span class="token comment"># cuanta memoria necesita la aplicacion</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token key atrule">memory</span><span class="token punctuation">:</span> 2G
    <span class="token comment"># que version de Liceo se va a desplegar</span>
    <span class="token key atrule">version</span><span class="token punctuation">:</span> latest
    <span class="token comment"># lenguage por defecto que se va a ejecutar</span>
    <span class="token key atrule">locale</span><span class="token punctuation">:</span> en
    <span class="token comment"># datos de conexion con la base de datos</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span>
      <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token string">&quot;jdbc:postgresql://liceo-db:5432/liceo&quot;</span>
      <span class="token key atrule">username</span><span class="token punctuation">:</span> liceo
      <span class="token key atrule">password</span><span class="token punctuation">:</span> liceo
      <span class="token key atrule">driver</span><span class="token punctuation">:</span> org.postgresql.Driver
    <span class="token comment"># donde se guardaran los ficheros: fotos, documentos...</span>
    <span class="token key atrule">storagepath</span><span class="token punctuation">:</span> /app/storage
    <span class="token comment"># datos iniciales del administrador principal</span>
    <span class="token key atrule">admin</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> admin
      <span class="token key atrule">username</span><span class="token punctuation">:</span> admin
      <span class="token key atrule">password</span><span class="token punctuation">:</span> admin
      <span class="token key atrule">email</span><span class="token punctuation">:</span> admin@email.com
  <span class="token key atrule">service</span><span class="token punctuation">:</span>  
    <span class="token comment"># en que puerto estara desplegado Liceo para otros servicios</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>        
</code></pre></div><h3 id="ejecutando-el-chart"><a href="#ejecutando-el-chart" class="header-anchor">#</a> Ejecutando el chart</h3> <p>Una vez creado el fichero <code>values.yaml</code> dentro del directorio clonado, situate en el mismo directorio desde el que hemos ejecutado <code>git clone</code>. Ahora podremos instalar nuestro chart en el entorno de al que apunte nuestra configuracion de kubernetes ejecutando:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>helm <span class="token function">install</span> liceo ./liceo-helm
</code></pre></div><h3 id="liceo-sh"><a href="#liceo-sh" class="header-anchor">#</a> liceo.sh</h3> <p>Dentro de los ficheros que contiene el repositorio <strong>liceo-helm</strong> se encuentra el fichero <strong>liceo.sh</strong>. Este script contiene una serie de tareas de mantenimiento que pueden ser utiles dentro del entorno de Kubernetes como realizar backups de la base de datos o de los ficheros que se hayan subido a la instancia de Liceo. Si entramos en el directorio del repositorio <strong>liceo-helm</strong> que hemos clonado y ejecutamos:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>./liceo.sh
</code></pre></div><p>Se nos mostraran las distintas tareas disponibles:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>liceo.sh redeploy<span class="token operator">|</span>list<span class="token operator">|</span>backup-all<span class="token operator">|</span>backup-db<span class="token operator">|</span>backup-files
</code></pre></div><ul><li><strong>redeploy</strong>: puede redesplegar las instancias de Liceo web o de la base de datos</li> <li><strong>list</strong>: lista los pods que se estan ejecutando</li> <li><strong>backup-db</strong>: ejecuta el backup de la base de datos</li> <li><strong>backup-files</strong>: ejecuta el backup de los ficheros de Liceo</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/liceo-social/liceo-social.github.io/edit/master/src/install/k8s-helm.md" target="_blank" rel="noopener noreferrer">Editar esta pagina en Github!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/install/docker-compose.html" class="prev">
        Docker Compose
      </a></span> <span class="next"><a href="/install/manual.html">
        Manual
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.728012cb.js" defer></script><script src="/assets/js/2.4ce31a1d.js" defer></script><script src="/assets/js/22.29424e28.js" defer></script>
  </body>
</html>
