(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{375:function(e,a,s){"use strict";s.r(a);var t=s(42),n=Object(t.a)({},(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"kubernetes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes"}},[e._v("#")]),e._v(" Kubernetes")]),e._v(" "),s("h2",{attrs:{id:"helm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#helm"}},[e._v("#")]),e._v(" Helm")]),e._v(" "),s("h3",{attrs:{id:"prerequisitos"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#prerequisitos"}},[e._v("#")]),e._v(" Prerequisitos")]),e._v(" "),s("p",[e._v("Para poder desplegar Liceo en un entorno Kubernetes, hemos creado un chart de Helm. Este chart despliega una instancia de Liceo y una instancia de PostgreSQL como base de datos. Esta instalacion presupone que se quiere ejecutar Helm desde una maquina locale instalar el chart de Helm en un entorno de Kubernetes remoto.")]),e._v(" "),s("p",[e._v("Para poder utilizar este chart previamente se debe:")]),e._v(" "),s("ul",[s("li",[e._v("Instalar kubectl ("),s("a",{attrs:{href:"https://kubernetes.io/es/docs/tasks/tools/install-kubectl/",target:"_blank",rel:"noopener noreferrer"}},[e._v("documentacion externa"),s("OutboundLink")],1),e._v(")")]),e._v(" "),s("li",[e._v("Instalar Helm ("),s("a",{attrs:{href:"https://helm.sh/docs/intro/install/",target:"_blank",rel:"noopener noreferrer"}},[e._v("documentacion externa"),s("OutboundLink")],1),e._v(")")]),e._v(" "),s("li",[e._v("Clonar el chart de Helm")]),e._v(" "),s("li",[e._v("Ejecutar el chart de Helm")])]),e._v(" "),s("p",[e._v("Para instalar kubectl y Helm recomendamos visitar la documentacion de ambos proyectos. Una vez instalados kubectl y Helm deberemos clonar el repositorio liceo-helm en nuestra maquina local usando "),s("a",{attrs:{href:"https://git-scm.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Git"),s("OutboundLink")],1),e._v(":")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" clone https://github.com/liceo-social/liceo-helm.github.io\n")])])]),s("h3",{attrs:{id:"configurando-el-chart"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configurando-el-chart"}},[e._v("#")]),e._v(" Configurando el chart")]),e._v(" "),s("p",[e._v("Una vez clonado, deberemos crear un fichero "),s("code",[e._v("values.yaml")]),e._v(" con los valores que queramos para la instancia de Liceo en el entorno en el que lo vamos a instalar: password del administrador, de la base de datos, donde se guardaran los ficheros...etc. Hay un fichero "),s("code",[e._v("values.yaml.template")]),e._v(" que se puede usar de guia. Por un lado estan la configuracion de la base de datos:")]),e._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("db")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("deployment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# donde se guardara la base de datos en disco")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("disk_mount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" /var/data\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("pg_data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" /var/data/liceo    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# nombre de la base de datos")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" liceo\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# nombre del usuario de la base de datos")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" liceo\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# password del usuario de la base de datos")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" liceo\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# puerto en el que se expone el contenedor")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("5432")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("service")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# puerto en el que se expondra el servicio al resto de servicios k8s")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("5432")]),e._v("\n")])])]),s("p",[e._v("Y por otro el de la instancia de Liceo:")]),e._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("web")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("deployment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# cuanta memoria necesita la aplicacion")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("memory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" 2G\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# que version de Liceo se va a desplegar")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" latest\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# lenguage por defecto que se va a ejecutar")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("locale")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" en\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# url en la que estara disponible Liceo ")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"https://liceo-web-socseross.cloud.okteto.net"')]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# datos de conexion con la base de datos")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("database")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"jdbc:postgresql://liceo-db:5432/liceo"')]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" liceo\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" liceo\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("driver")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" org.postgresql.Driver\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# donde se guardaran los ficheros: fotos, documentos...")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("storagepath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" /app/storage\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# datos iniciales del administrador principal")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("admin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" admin\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" admin\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" admin\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("email")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" admin@email.com\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("service")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("  \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# en que puerto estara desplegado Liceo para otros servicios")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("8080")]),e._v("        \n")])])]),s("h3",{attrs:{id:"ejecutando-el-chart"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ejecutando-el-chart"}},[e._v("#")]),e._v(" Ejecutando el chart")]),e._v(" "),s("p",[e._v("Una vez creado el fichero "),s("code",[e._v("values.yaml")]),e._v(" dentro del directorio clonado, situate en el mismo directorio desde el que hemos ejecutado "),s("code",[e._v("git clone")]),e._v(". Ahora podremos instalar nuestro chart en el entorno de al que apunte nuestra configuracion de kubernetes ejecutando:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("helm "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" liceo ./liceo-helm\n")])])]),s("h3",{attrs:{id:"liceo-sh"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#liceo-sh"}},[e._v("#")]),e._v(" liceo.sh")]),e._v(" "),s("p",[e._v("Dentro de los ficheros que contiene el repositorio "),s("strong",[e._v("liceo-helm")]),e._v(" se encuentra el fichero "),s("strong",[e._v("liceo.sh")]),e._v(". Este script contiene una serie de tareas de mantenimiento que pueden ser utiles dentro del entorno de Kubernetes como realizar backups de la base de datos o de los ficheros que se hayan subido a la instancia de Liceo. Si entramos en el directorio del repositorio "),s("strong",[e._v("liceo-helm")]),e._v(" que hemos clonado y ejecutamos:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("./liceo.sh\n")])])]),s("p",[e._v("Se nos mostraran las distintas tareas disponibles:")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("liceo.sh redeploy"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("list"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("backup-all"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("backup-db"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("backup-files\n")])])]),s("ul",[s("li",[s("strong",[e._v("redeploy")]),e._v(": puede redesplegar las instancias de Liceo web o de la base de datos")]),e._v(" "),s("li",[s("strong",[e._v("list")]),e._v(": lista los pods que se estan ejecutando")]),e._v(" "),s("li",[s("strong",[e._v("backup-all")]),e._v(": ejecuta el backup de la base de datos y de los ficheros de Liceo")]),e._v(" "),s("li",[s("strong",[e._v("backup-db")]),e._v(": ejecuta el backup de la base de datos")]),e._v(" "),s("li",[s("strong",[e._v("backup-files")]),e._v(": ejecuta el backup de los ficheros de Liceo")])])])}),[],!1,null,null,null);a.default=n.exports}}]);